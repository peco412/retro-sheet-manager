<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sheet Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.7/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    body {
      background: radial-gradient(ellipse at center, #0d1b2a 0%, #000000 100%);
      font-family: 'Orbitron', 'Courier New', monospace;
      color: #d3f9f5;
    }
    .retro-border {
      border: 2px dashed #f9c74f;
      box-shadow: 0 0 20px #f9c74f88;
    }
    .retro-glow:hover {
      background-color: #1a1a1a;
      color: #f9c74f;
      box-shadow: 0 0 5px #f9c74f, 0 0 10px #f9c74f, 0 0 20px #f9c74f;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <div id="root"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDdJIww8ZPApVUtblguLGLMwqpHQE2P5xw",
      authDomain: "sheetmanagermkt.firebaseapp.com",
      projectId: "sheetmanagermkt",
      storageBucket: "sheetmanagermkt.appspot.com",
      messagingSenderId: "22647060478",
      appId: "1:22647060478:web:323baa9e7643375aef72af"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [userRole, setUserRole] = useState(null);
      const [sheets, setSheets] = useState([]);
      const [filteredSheets, setFilteredSheets] = useState([]);
      const [searchQuery, setSearchQuery] = useState('');
      const [newSheet, setNewSheet] = useState({ name: '', url: '', folder: 'RSA', subfolder: 'T√†i li·ªáu' });
      const [selectedFolder, setSelectedFolder] = useState('RSA');
      const [selectedSubfolder, setSelectedSubfolder] = useState('All');

      const credentials = {
        admin: { username: 'QLAPT', password: 'QLAPT', role: 'admin' },
        user: { username: 'Marketing@2022', password: 'Marketing@2022', role: 'user' }
      };

      const fetchSheets = async () => {
        try {
          const snapshot = await db.collection("sheets").get();
          const fetched = snapshot.docs.map((doc, index) => ({ id: doc.id, ...doc.data(), index }));
          setSheets(fetched);
          setFilteredSheets(fetched);
        } catch (err) {
          console.error("Fetch error:", err);
        }
      };

      const addSheet = async (e) => {
        e.preventDefault();
        if (!newSheet.name || !newSheet.url) return alert("Please fill all fields");
        try {
          await db.collection("sheets").add(newSheet);
          setNewSheet({ name: '', url: '', folder: 'RSA', subfolder: 'T√†i li·ªáu' });
          fetchSheets();
        } catch (err) {
          alert("Error adding sheet");
        }
      };

      const deleteSheet = async (id) => {
        if (userRole !== 'admin') return alert("Only admin can delete");
        try {
          await db.collection("sheets").doc(id).delete();
          fetchSheets();
        } catch (err) {
          alert("Error deleting sheet");
        }
      };

      const handleLogin = (e) => {
        e.preventDefault();
        const username = e.target.username.value;
        const password = e.target.password.value;
        if (username === credentials.admin.username && password === credentials.admin.password) {
          setIsLoggedIn(true);
          setUserRole("admin");
        } else if (username === credentials.user.username && password === credentials.user.password) {
          setIsLoggedIn(true);
          setUserRole("user");
        } else {
          alert("Invalid credentials");
        }
      };

      useEffect(() => {
        if (isLoggedIn) fetchSheets();
      }, [isLoggedIn]);

      useEffect(() => {
        let filtered = sheets.filter(sheet => sheet.folder === selectedFolder);
        if (selectedSubfolder !== 'All') filtered = filtered.filter(sheet => sheet.subfolder === selectedSubfolder);
        if (searchQuery) filtered = filtered.filter(sheet => sheet.name.toLowerCase().includes(searchQuery.toLowerCase()));
        setFilteredSheets(filtered);
      }, [sheets, selectedFolder, selectedSubfolder, searchQuery]);

      if (!isLoggedIn) {
        return (
          <div className="flex items-center justify-center min-h-screen bg-black bg-opacity-80">
            <div className="bg-green-900 p-10 rounded-lg retro-border w-96 text-center">
              <h2 className="text-xl font-bold text-yellow-300 mb-2">C·ªòNG H√íA X√É H·ªòI CH·ª¶ NGHƒ®A VI·ªÜT NAM</h2>
              <p className="text-yellow-200 mb-6">ƒê·ªôc l·∫≠p - T·ª± do - H·∫°nh ph√∫c</p>
              <form onSubmit={handleLogin} className="space-y-4">
                <input type="text" name="username" placeholder="Username" className="w-full p-2 rounded bg-green-800 text-white" required />
                <input type="password" name="password" placeholder="Password" className="w-full p-2 rounded bg-green-800 text-white" required />
                <button type="submit" className="w-full bg-yellow-400 hover:bg-yellow-500 p-2 rounded text-black font-bold">ƒêƒÉng nh·∫≠p</button>
              </form>
            </div>
          </div>
        );
      }

      return (
        <div className="container mx-auto p-6">
          <header className="text-center mb-6">
            <h1 className="text-4xl font-bold text-yellow-400 drop-shadow-lg">üõ∞ Marketing Sheet Manager</h1>
            <p className="text-gray-400">B·∫°n c√≥ sheet, t√¥i c√≥ space</p>
          </header>

          <div className="bg-gray-900 p-6 rounded-lg mb-6 retro-border">
            <form onSubmit={addSheet} className="space-y-4">
              <input type="text" placeholder="Sheet Name" value={newSheet.name} onChange={(e) => setNewSheet({ ...newSheet, name: e.target.value })} className="w-full p-2 rounded bg-gray-800" required />
              <input type="text" placeholder="URL" value={newSheet.url} onChange={(e) => setNewSheet({ ...newSheet, url: e.target.value })} className="w-full p-2 rounded bg-gray-800" required />
              <select value={newSheet.folder} onChange={(e) => setNewSheet({ ...newSheet, folder: e.target.value })} className="w-full p-2 rounded bg-gray-800">
                <option value="RSA">RSA</option>
                <option value="RSQ">RSQ</option>
                <option value="RAF">RAF</option>
              </select>
              <select value={newSheet.subfolder} onChange={(e) => setNewSheet({ ...newSheet, subfolder: e.target.value })} className="w-full p-2 rounded bg-gray-800">
                <option value="T√†i li·ªáu">T√†i li·ªáu</option>
                <option value="K·∫ø ho·∫°ch">K·∫ø ho·∫°ch</option>
              </select>
              <button type="submit" className="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded text-white font-semibold">Add Sheet</button>
            </form>
          </div>

          <div className="flex space-x-2 mb-4 justify-center">
            {['RSA', 'RSQ', 'RAF'].map(folder => (
              <button key={folder} onClick={() => setSelectedFolder(folder)} className={`p-2 rounded retro-glow ${selectedFolder === folder ? 'bg-yellow-400 text-black' : 'bg-gray-700'}`}>{folder}</button>
            ))}
          </div>

          <div className="flex space-x-2 mb-4 justify-center">
            {['All', 'T√†i li·ªáu', 'K·∫ø ho·∫°ch'].map(sub => (
              <button key={sub} onClick={() => setSelectedSubfolder(sub)} className={`p-2 rounded ${selectedSubfolder === sub ? 'bg-yellow-300 text-black' : 'bg-gray-800'}`}>{sub}</button>
            ))}
          </div>

          <div className="flex justify-center mb-6">
            <input type="text" placeholder="T√¨m sheet..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="p-2 rounded w-1/2 bg-gray-800" />
          </div>

          <div className="grid grid-cols-1 gap-4">
            {filteredSheets.map(sheet => (
              <div key={sheet.id} className="bg-gray-800 p-4 rounded flex justify-between items-center retro-border">
                <div>
                  <a href={sheet.url} target="_blank" className="text-blue-400 hover:underline text-lg font-bold">{sheet.name}</a>
                  <p className="text-sm text-gray-400">{sheet.folder} / {sheet.subfolder}</p>
                </div>
                {userRole === 'admin' && (
                  <button onClick={() => deleteSheet(sheet.id)} className="bg-red-600 hover:bg-red-700 p-2 rounded text-white">Delete</button>
                )}
              </div>
            ))}
          </div>

          <footer className="mt-10 text-center text-gray-400 text-sm">Created by MarketingTeamVN</footer>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
